<!DOCTYPE html>
<html lang="th">
  <head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ó‡∏≥‡πÄ‡∏ô‡∏µ‡∏¢‡∏ö‡∏£‡∏∏‡πà‡∏ô ‡∏û‡∏™‡∏û.13</title>
    <link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/6/6f/Seal_of_the_Department_of_Special_Investigation.png">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
      :root { --primary-color: #1e3c72; --secondary-color: #2a5298; --bg-color: #f8f9fa; }
      body { font-family: 'Sarabun', sans-serif; background-color: var(--bg-color); color: #333; }
      
      .header-bg {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white; padding: 30px 15px 80px; border-radius: 0 0 30px 30px;
        position: relative; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center;
      }
      .logo-img { height: 70px; width: auto; display: block; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3)); margin: 0 auto 10px; }
      
      .search-wrapper { position: sticky; top: 0; z-index: 1020; padding: 10px 15px; margin-top: -60px; }
      .search-box { max-width: 600px; margin: 0 auto; background: rgba(255,255,255,0.95); backdrop-filter: blur(5px); padding: 15px; border-radius: 20px; box-shadow: 0 8px 32px rgba(31,38,135,0.15); }
      .search-input { border-radius: 50px; padding: 12px 25px; border: 1px solid #e0e0e0; width: 100%; font-size: 1.1rem; padding-left: 45px; }
      .search-input:focus { outline: none; border-color: var(--secondary-color); box-shadow: 0 0 0 4px rgba(42,82,152,0.1); }
      .fa-search { position: absolute; left: 30px; top: 28px; color: #aaa; }

      .dept-header { display: flex; align-items: center; margin: 30px 0 15px; padding-bottom: 8px; border-bottom: 2px solid #e9ecef; }
      .dept-title { color: var(--primary-color); font-weight: 700; font-size: 1.3rem; margin-right: 10px; }
      .dept-badge { background-color: var(--secondary-color); color: white; padding: 2px 10px; border-radius: 12px; font-size: 0.8rem; }

      .member-card { background: white; border-radius: 16px; padding: 20px; height: 100%; box-shadow: 0 2px 8px rgba(0,0,0,0.04); position: relative; display: flex; flex-direction: column; justify-content: space-between; transition: 0.2s; border-left: 5px solid var(--primary-color); }
      .member-card:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(0,0,0,0.08); }
      .edit-icon { position: absolute; top: 15px; right: 15px; color: #ced4da; cursor: pointer; z-index: 5; }
      .edit-icon:hover { color: var(--secondary-color); transform: scale(1.1); }

      .member-name { font-size: 1.15rem; font-weight: 700; color: var(--primary-color); margin-bottom: 0px; padding-right: 20px; }
      .member-nick { display: inline-block; font-weight: 500; font-size: 0.95em; color: #555; margin-left: 5px; }
      .member-pos { color: #6c757d; font-size: 0.9rem; margin-bottom: 10px; margin-top: 5px; }
      
      /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏õ‡πâ‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î */
      .bd-badge { 
        font-size: 0.85rem; 
        background-color: #fff3cd; 
        color: #856404; 
        padding: 4px 10px; 
        border-radius: 20px; 
        display: inline-block; 
        margin-top: 5px; 
        border: 1px solid #ffeeba;
      }

      .card-footer-custom { border-top: 1px solid #f1f3f5; padding-top: 12px; display: flex; justify-content: flex-end; gap: 8px; margin-top: 15px; }
      .btn-icon { width: 38px; height: 38px; border-radius: 50%; display: flex; align-items: center; justify-content: center; text-decoration: none; transition: 0.2s; }
      .btn-phone { background: #f0f7ff; color: #0d6efd; } .btn-line { background: #f0fff4; color: #198754; } .btn-email { background: #fff8f0; color: #fd7e14; }
      .btn-icon:hover { transform: scale(1.1); filter: brightness(0.95); }

      .fab-add { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: var(--primary-color); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 4px 20px rgba(30,60,114,0.4); cursor: pointer; z-index: 2000; transition: transform 0.3s; }
      .fab-add:hover { transform: scale(1.1) rotate(90deg); background: var(--secondary-color); }
      
      .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary-color); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 40px auto; }
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
  </head>
  <body>

    <div class="header-bg">
      <div class="container">
        <img src="https://www.dsi.go.th/images/logo-text-dsi.png" alt="DSI Logo" class="logo-img">
        <h3 class="fw-bold mb-0">‡∏ó‡∏≥‡πÄ‡∏ô‡∏µ‡∏¢‡∏ö‡∏£‡∏∏‡πà‡∏ô ‡∏û‡∏™‡∏û.13</h3>
        <small class="text-white-50">DSI - Special Case Inquiry Official - Class 13</small>
      </div>
    </div>

    <div class="search-wrapper">
      <div class="search-box">
        <div class="position-relative">
          <i class="fas fa-search"></i>
          <input type="text" id="searchInput" class="search-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡∏ä‡∏∑‡πà‡∏≠, ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô, ‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î..." onkeyup="filterData()">
        </div>
      </div>
    </div>

    <div class="container pb-5" style="margin-top: 20px;">
      <div id="loader" class="loader"></div>
      <div id="contentArea"></div>
      <div id="noResults" class="text-center mt-5" style="display:none;">
        <h5 class="text-muted">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h5>
      </div>
    </div>

    <div class="fab-add" onclick="openModal()" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠"><i class="fas fa-plus"></i></div>

    <div class="modal fade" id="dataModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content border-0 shadow-lg">
          <div class="modal-header bg-light">
            <h5 class="modal-title fw-bold" id="modalTitle">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body p-4">
            <form id="memberForm" onsubmit="handleFormSubmit(event)">
              <input type="hidden" id="recId" name="recId">
              <div class="row g-3">
                <div class="col-12 col-md-8">
                  <label class="form-label small fw-bold text-muted">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label>
                  <input type="text" class="form-control" id="name" name="name" required>
                </div>
                <div class="col-12 col-md-4">
                  <label class="form-label small fw-bold text-muted">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</label>
                  <input type="text" class="form-control" id="nickname" name="nickname">
                </div>
                <div class="col-12 col-md-6">
                  <label class="form-label small fw-bold text-muted">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label>
                  <input type="text" class="form-control" id="position" name="position" value="‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≠‡∏ö‡∏™‡∏ß‡∏ô‡∏Ñ‡∏î‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£">
                </div>
                <div class="col-12 col-md-6">
                  <label class="form-label small fw-bold text-muted">‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î</label>
                  <select class="form-select" id="dept" name="dept">
                    <option value="" selected disabled>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î --</option>
                  </select>
                </div>
                <div class="col-12 col-md-4">
                    <label class="form-label small fw-bold text-muted">‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î</label>
                    <input type="date" class="form-control" id="birthdate" name="birthdate">
                </div>
              </div>
              <div class="bg-light p-3 rounded mt-4 border">
                <label class="d-block small fw-bold text-primary mb-2">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label>
                <div class="row g-3">
                  <div class="col-12 col-md-4">
                    <input type="tel" class="form-control" id="phone" name="phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå">
                  </div>
                  <div class="col-12 col-md-4">
                    <input type="text" class="form-control" id="lineId" name="lineId" placeholder="Line ID">
                  </div>
                  <div class="col-12 col-md-4">
                    <input type="email" class="form-control" id="email" name="email" placeholder="E-mail">
                  </div>
                </div>
              </div>
              <div class="d-flex gap-2 mt-4 pt-2">
                <button type="submit" id="btnSave" class="btn btn-primary flex-grow-1 rounded-pill">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
      let allData = [];
      let dataModal;

      const deptOptions = [
        "‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏≠‡∏ò‡∏¥‡∏ö‡∏î‡∏µ‡∏Å‡∏£‡∏°‡∏™‡∏≠‡∏ö‡∏™‡∏ß‡∏ô‡∏Ñ‡∏î‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏™‡∏ô‡∏á.‡∏≠‡∏™‡∏û.)",
        "‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏≠‡∏á‡∏≠‡∏ò‡∏¥‡∏ö‡∏î‡∏µ‡∏Å‡∏£‡∏°‡∏™‡∏≠‡∏ö‡∏™‡∏ß‡∏ô‡∏Ñ‡∏î‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏™‡∏ô‡∏á.‡∏£‡∏≠‡∏á‡∏Ø 1)",
        "‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏≠‡∏á‡∏≠‡∏ò‡∏¥‡∏ö‡∏î‡∏µ‡∏Å‡∏£‡∏°‡∏™‡∏≠‡∏ö‡∏™‡∏ß‡∏ô‡∏Ñ‡∏î‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏™‡∏ô‡∏á.‡∏£‡∏≠‡∏á‡∏Ø 2)",
        "‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏≠‡∏á‡∏≠‡∏ò‡∏¥‡∏ö‡∏î‡∏µ‡∏Å‡∏£‡∏°‡∏™‡∏≠‡∏ö‡∏™‡∏ß‡∏ô‡∏Ñ‡∏î‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏™‡∏ô‡∏á.‡∏£‡∏≠‡∏á‡∏Ø 3)",
        "‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏≠‡∏á‡∏≠‡∏ò‡∏¥‡∏ö‡∏î‡∏µ‡∏Å‡∏£‡∏°‡∏™‡∏≠‡∏ö‡∏™‡∏ß‡∏ô‡∏Ñ‡∏î‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏™‡∏ô‡∏á.‡∏£‡∏≠‡∏á‡∏Ø 4)",
        "‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏î‡πâ‡∏≤‡∏ô‡∏Ñ‡∏î‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏™‡∏ô‡∏á.‡∏ä‡∏ä)",
        "‡∏Å‡∏≠‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÅ‡∏•‡∏∞‡∏Ñ‡∏î‡∏µ‡∏≠‡∏≤‡∏ä‡∏ç‡∏Å‡∏£‡∏£‡∏°‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏® (‡∏Å‡∏ï‡∏ó.)",
        "‡∏Å‡∏≠‡∏á‡∏Ñ‡∏î‡∏µ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏® (‡∏Å‡∏Ñ‡∏ó.)",
        "‡∏Å‡∏≠‡∏á‡∏Ñ‡∏î‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ü‡∏≠‡∏Å‡πÄ‡∏á‡∏¥‡∏ô (‡∏Å‡∏Ñ‡∏á.)",
        "‡∏Å‡∏≠‡∏á‡∏Ñ‡∏î‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á (‡∏Å‡∏°‡∏Ñ.)",
        "‡∏Å‡∏≠‡∏á‡∏Ñ‡∏î‡∏µ‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏° (‡∏Å‡∏Ñ‡∏™.)",
        "‡∏Å‡∏≠‡∏á‡∏Ñ‡∏î‡∏µ‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏õ‡∏±‡∏ç‡∏ç‡∏≤ (‡∏Å‡∏Ñ‡∏õ.)",
        "‡∏Å‡∏≠‡∏á‡∏Ñ‡∏î‡∏µ‡∏†‡∏≤‡∏©‡∏µ‡∏≠‡∏≤‡∏Å‡∏£ (‡∏Å‡∏Ñ‡∏†.)",
        "‡∏Å‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏î‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏†‡∏≤‡∏Ñ (‡∏Å‡∏õ‡∏†.)",
        "‡∏Å‡∏≠‡∏á‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡πÅ‡∏•‡∏∞‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö (‡∏Å‡∏ó‡∏®.)",
        "‡∏Å‡∏≠‡∏á‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏¢‡∏∏‡∏ó‡∏ò‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå (‡∏Å‡∏ô‡∏¢.)",
        "‡∏Å‡∏≠‡∏á‡∏Ñ‡∏î‡∏µ‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ö (‡∏Å‡∏Ñ‡∏ò.)",
        "‡∏Å‡∏≠‡∏á‡∏Ñ‡∏î‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏±‡∏ê (‡∏Å‡∏Ñ‡∏£.)",
        "‡∏Å‡∏≠‡∏á‡∏Ñ‡∏î‡∏µ‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡πÇ‡∏†‡∏Ñ (‡∏Å‡∏Ñ‡∏ö.)",
        "‡∏Å‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏Å‡∏õ‡∏û‡∏®.)",
        "‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏≤‡∏ô‡∏∏‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏° (‡∏™‡∏•‡∏Å.)",
        "‡∏Å‡∏≠‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏Ñ‡∏î‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏Å‡∏û‡∏ô.)",
        "‡∏Å‡∏≠‡∏á‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢ (‡∏Å‡∏Å‡∏°.)",
        "‡∏Å‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏Ñ‡∏î‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏Å‡∏ö‡∏û.)",
        "‡∏Å‡∏≠‡∏á‡∏Ñ‡∏î‡∏µ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå (‡∏Å‡∏Ñ‡∏°.)",
        "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏™‡∏∑‡∏ö‡∏™‡∏ß‡∏ô‡∏™‡∏∞‡∏Å‡∏î‡∏£‡∏≠‡∏¢‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Ç‡πà‡∏≤‡∏ß",
        "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (‡∏Å‡∏ö‡∏Ñ.)",
        "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏î‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏Å‡∏á‡∏û.)",
        "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô (‡∏Å‡∏ï‡∏ô.)",
        "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ (‡∏Å‡∏û‡∏£.)",
        "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏•‡∏π‡∏Å‡∏´‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ò‡∏£‡∏£‡∏°",
        "‡∏Å‡∏≠‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∏‡∏ï‡∏¥‡∏ò‡∏£‡∏£‡∏° (‡∏Å‡∏≠‡∏ò.)",
        "‡∏Å‡∏≠‡∏á‡∏Ñ‡∏î‡∏µ‡∏Å‡∏≤‡∏£‡∏ü‡∏≠‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏≠‡∏≤‡∏ç‡∏≤ (‡∏Å‡∏Ñ‡∏ü.)",
        "‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏î‡∏µ‡∏•‡∏∞‡πÄ‡∏°‡∏¥‡∏î‡∏ó‡∏≤‡∏á‡πÄ‡∏û‡∏®‡πÄ‡∏î‡πá‡∏Å (‡∏Ñ‡∏î.)",
        "‡∏Å‡∏≠‡∏á‡∏Ñ‡∏î‡∏µ‡∏¢‡∏≤‡πÄ‡∏™‡∏û‡∏ï‡∏¥‡∏î (‡∏Å‡∏¢‡∏™.)",
        "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏î‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà 1 (‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤)",
        "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏î‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà 2 (‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ)",
        "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏î‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà 3 (‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤)",
        "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏î‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà 4 (‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô)",
        "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏î‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà 5 (‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà)",
        "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏î‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà 6 (‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å)",
        "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏î‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà 7 (‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ)",
        "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏î‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà 8 (‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ)",
        "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏î‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà 9 (‡∏™‡∏á‡∏Ç‡∏•‡∏≤)",
        "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏î‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà 10 (‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô‡∏†‡∏≤‡∏Ñ‡πÉ‡∏ï‡πâ)"
      ];

      function safeAlert(title, text, icon) {
          if (typeof Swal !== 'undefined') {
              Swal.fire(title, text, icon);
          } else {
              alert(`${title}\n${text}`);
          }
      }

      document.addEventListener('DOMContentLoaded', function() {
        fetchData();
        dataModal = new bootstrap.Modal(document.getElementById('dataModal'));
        populateDeptDropdown();
        
        const pInput = document.getElementById('phone');
        if(pInput){
            pInput.addEventListener('input', function (e) {
                let x = e.target.value.replace(/\D/g, '').match(/(\d{0,3})(\d{0,3})(\d{0,4})/);
                e.target.value = !x[2] ? x[1] : x[1] + '-' + x[2] + (x[3] ? '-' + x[3] : '');
            });
        }
      });

      function populateDeptDropdown() {
        const select = document.getElementById('dept');
        select.innerHTML = '<option value="" selected disabled>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î --</option>';
        deptOptions.forEach(opt => {
          const option = document.createElement('option');
          option.value = opt; option.text = opt;
          select.appendChild(option);
        });
      }

      function fetchData() {
        document.getElementById('loader').style.display = 'block';
        document.getElementById('contentArea').innerHTML = '';
        document.getElementById('noResults').style.display = 'none';
        
        google.script.run
          .withSuccessHandler(function(jsonString) {
             document.getElementById('loader').style.display = 'none';
             try {
                const data = JSON.parse(jsonString);
                if (!data || data.length === 0) {
                   document.getElementById('noResults').style.display = 'block';
                   safeAlert('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Sheet (‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠ Sheet "Data")', 'warning');
                } else {
                   allData = data;
                   renderData(data);
                   checkBirthdayToday(data);
                }
             } catch (e) {
                safeAlert('Error', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + e.message, 'error');
             }
          })
          .withFailureHandler(function(err){
             document.getElementById('loader').style.display = 'none';
             safeAlert('Error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Server ‡πÑ‡∏î‡πâ: ' + err.message, 'error');
          })
          .getData();
      }

      function renderData(data) {
        const container = document.getElementById('contentArea');
        container.innerHTML = '';
        
        if (data.length === 0) {
          document.getElementById('noResults').style.display = 'block'; return;
        } else {
          document.getElementById('noResults').style.display = 'none';
        }

        const groups = {};
        data.forEach(row => {
          let dept = row[4] ? row[4].toString().trim() : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î';
          if(dept === "") dept = '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î';
          if(!groups[dept]) groups[dept] = [];
          groups[dept].push(row);
        });

        const sortedDepts = Object.keys(groups).sort((a,b) => a.localeCompare(b, 'th'));
        let html = '';

        sortedDepts.forEach(dept => {
          const members = groups[dept];
          members.sort((a,b) => (a[1]||"").localeCompare((b[1]||""), 'th'));

          html += `<div class="dept-header"><span class="dept-title">${dept}</span><span class="dept-badge">${members.length}</span></div><div class="row g-3 mb-4">`;

          members.forEach(row => {
            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏° Index
            const id = row[0];
            const name = row[1];
            const nickname = row[2];
            const position = row[3];
            const phone = row[5];
            const line = row[6];
            const email = row[7];
            const birthdate = row[8];
            const committeeRole = row[9]; // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå J = Index 9

            const displayNick = nickname ? `<span class="member-nick">(${nickname})</span>` : '';
            
            // --- 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á Badge ‡∏Ñ‡∏ì‡∏∞‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£ ---
            let committeeBadge = '';
            if (committeeRole && committeeRole.toString().trim() !== '') {
                // ‡πÄ‡∏û‡∏¥‡πà‡∏° margin-bottom ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡πâ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢
                committeeBadge = `
                  <div style="margin-top: 2px; margin-bottom: 6px;">
                    <span class="badge bg-success rounded-pill" style="font-weight:500; font-size: 0.8rem;">
                      <i class="fas fa-star me-1 text-warning"></i>${committeeRole}
                    </span>
                  </div>`;
            }

            // --- 2. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î ---
            let bdDisplay = '';
            let day, month, year;
            
            if (birthdate) {
                let str = birthdate.toString().trim();
                if (str.includes('/')) {
                    const parts = str.split('/');
                    if (parts.length === 3) {
                        day = parseInt(parts[0]);
                        month = parseInt(parts[1]);
                        year = parseInt(parts[2]);
                    }
                } else if (str.includes('-')) {
                    const parts = str.split('-');
                    if (parts.length === 3) {
                        year = parseInt(parts[0]);
                        month = parseInt(parts[1]);
                        day = parseInt(parts[2]);
                    }
                }
            }

            if (day && month && year) {
                const monthsTh = ["‡∏°.‡∏Ñ.", "‡∏Å.‡∏û.", "‡∏°‡∏µ.‡∏Ñ.", "‡πÄ‡∏°.‡∏¢.", "‡∏û.‡∏Ñ.", "‡∏°‡∏¥.‡∏¢.", "‡∏Å.‡∏Ñ.", "‡∏™.‡∏Ñ.", "‡∏Å.‡∏¢.", "‡∏ï.‡∏Ñ.", "‡∏û.‡∏¢.", "‡∏ò.‡∏Ñ."];
                const yearTh = year < 2400 ? year + 543 : year;
                bdDisplay = `<div class="bd-badge">üéÇ ${day} ${monthsTh[month-1] || '-'} ${yearTh}</div>`;
            } else if (birthdate) {
                bdDisplay = `<div class="bd-badge">${birthdate}</div>`;
            }

            // --- 3. ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ ---
            let btns = '';
            const cleanPhone = phone ? phone.toString().replace(/\D/g, '') : '';
            if(cleanPhone.length > 8) btns += `<a href="tel:${cleanPhone}" target="_top" class="btn-icon btn-phone"><i class="fas fa-phone"></i></a>`;
            if(line) btns += `<a href="https://line.me/ti/p/~${line}" target="_blank" class="btn-icon btn-line"><i class="fab fa-line"></i></a>`;
            if(email) btns += `<a href="mailto:${email}" class="btn-icon btn-email"><i class="fas fa-envelope"></i></a>`;

            // --- 4. ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏£‡πà‡∏≤‡∏á (‡∏¢‡πâ‡∏≤‡∏¢‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á Badge) ---
            html += `
              <div class="col-12 col-md-6 col-lg-4">
                <div class="member-card">
                  <div class="edit-icon" onclick="openModal('${id}')"><i class="fas fa-pen"></i></div>
                  <div>
                    <div class="member-name">${name} ${displayNick}</div>
                    <div class="member-pos">${position || '-'}</div>
                    ${committeeBadge} ${bdDisplay}
                  </div>
                  <div class="card-footer-custom">${btns || '<small class="text-muted small">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</small>'}</div>
                </div>
              </div>`;
          });
          html += `</div>`;
        });
        container.innerHTML = html;
      }

      function checkBirthdayToday(data) {
          const today = new Date();
          const currentDay = today.getDate();
          const currentMonth = today.getMonth() + 1;
          let birthdayList = [];

          data.forEach(row => {
              if (row[8]) {
                  let d, m;
                  let str = row[8].toString().trim();
                  
                  // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÅ‡∏Å‡∏∞‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡∏Å‡∏¥‡∏î
                  if (str.includes('/')) {
                      const parts = str.split('/');
                      d = parseInt(parts[0]);
                      m = parseInt(parts[1]);
                  } else if (str.includes('-')) {
                      const parts = str.split('-');
                      d = parseInt(parts[2]);
                      m = parseInt(parts[1]);
                  }

                  if (d === currentDay && m === currentMonth) {
                      birthdayList.push(`${row[1]} (${row[2] || '-'})`);
                  }
              }
          });

          if (birthdayList.length > 0) {
              let htmlList = `<ul class="text-start mt-2">` + birthdayList.map(n => `<li>${n}</li>`).join('') + `</ul>`;
              safeAlert('üéÇ Happy Birthday!', `‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î<br>${htmlList}`, 'info');
          }
      }

      function filterData() {
        const input = document.getElementById('searchInput').value.toLowerCase();
        const filtered = allData.filter(row => {
            const txt = ((row[1]||"")+(row[2]||"")+(row[3]||"")+(row[4]||"")+(row[5]||"")).toLowerCase();
            return txt.includes(input);
        });
        renderData(filtered);
      }

      function openModal(id = null) {
        // 1. ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏´‡πâ‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Å‡πà‡∏≠‡∏ô
        document.getElementById('memberForm').reset();
        
        if(id) {
          // --- ‡∏Å‡∏£‡∏ì‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Edit Mode) ---
          document.getElementById('modalTitle').innerText = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
          document.getElementById('recId').value = id;

          // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
          const item = allData.find(r => r[0] == id);
          if(item) {
            document.getElementById('name').value = item[1];
            document.getElementById('nickname').value = item[2];
            document.getElementById('position').value = item[3];
            document.getElementById('dept').value = item[4]; 
            document.getElementById('phone').value = item[5] ? item[5].toString().replace(/'/g,'') : '';
            document.getElementById('lineId').value = item[6];
            document.getElementById('email').value = item[7];
            
            // ============================================================
            // ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡πÄ‡∏û‡∏µ‡πâ‡∏¢‡∏ô/‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
            // ============================================================
            if(item[8]) {
                let str = item[8].toString().trim();
                let yyyy, mm, dd;

                // ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 1: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ / (‡πÄ‡∏ä‡πà‡∏ô 5/4/1980)
                // ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏£‡∏Å‡πÄ‡∏õ‡πá‡∏ô "‡∏ß‡∏±‡∏ô" ‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô "‡πÄ‡∏î‡∏∑‡∏≠‡∏ô" ‡πÄ‡∏™‡∏°‡∏≠ (‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)
                if (str.includes('/')) {
                    const parts = str.split('/');
                    if (parts.length === 3) {
                        dd = parts[0].padStart(2, '0'); // ‡πÄ‡∏•‡∏Ç‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤ ‡∏Ñ‡∏∑‡∏≠ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
                        mm = parts[1].padStart(2, '0'); // ‡πÄ‡∏•‡∏Ç‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡∏≤‡∏á ‡∏Ñ‡∏∑‡∏≠ ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                        yyyy = parts[2];               // ‡πÄ‡∏•‡∏Ç‡∏ï‡∏±‡∏ß‡∏´‡∏•‡∏±‡∏á ‡∏Ñ‡∏∑‡∏≠ ‡∏õ‡∏µ
                    }
                } 
                // ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 2: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏µ‡∏î - ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏≠‡∏∑‡πà‡∏ô (Date Object/ISO)
                // (‡πÄ‡∏ä‡πà‡∏ô 2026-12-24T17:00... ‡∏´‡∏£‡∏∑‡∏≠ 1980-04-05)
                else {
                    let d = new Date(str);
                    if (!isNaN(d.getTime())) {
                        yyyy = d.getFullYear();
                        mm = (d.getMonth() + 1).toString().padStart(2, '0'); // ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ï‡πâ‡∏≠‡∏á +1 ‡πÄ‡∏™‡∏°‡∏≠‡πÉ‡∏ô JS
                        dd = d.getDate().toString().padStart(2, '0');
                    }
                }

                // ‡∏ô‡∏≥‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡∏∞‡πÑ‡∏î‡πâ ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á Input (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÄ‡∏õ‡πá‡∏ô ‡∏õ‡∏µ-‡πÄ‡∏î‡∏∑‡∏≠‡∏ô-‡∏ß‡∏±‡∏ô)
                if (yyyy && mm && dd) {
                    document.getElementById('birthdate').value = `${yyyy}-${mm}-${dd}`;
                }
            }
            // ============================================================
          }
        } else {
          // --- ‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà (Add Mode) ---
          document.getElementById('modalTitle').innerText = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà';
          document.getElementById('recId').value = "";
          
          // ‡∏Ñ‡πà‡∏≤ Default
          document.getElementById('position').value = "‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≠‡∏ö‡∏™‡∏ß‡∏ô‡∏Ñ‡∏î‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£";
          document.getElementById('dept').value = "";
        }
        
        dataModal.show();
      }

      function handleFormSubmit(e) {
        e.preventDefault();
        const btn = document.getElementById('btnSave');
        const orgText = btn.innerHTML;
        btn.disabled = true; btn.innerHTML = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

        const form = document.getElementById('memberForm');
        const formData = {
          recId: form.recId.value,
          name: form.name.value,
          nickname: form.nickname.value,
          position: form.position.value,
          dept: form.dept.value,
          phone: form.phone.value,
          lineId: form.lineId.value,
          email: form.email.value,
          birthdate: form.birthdate.value
        };

        google.script.run.withSuccessHandler(res => {
          dataModal.hide();
          btn.disabled = false; btn.innerHTML = orgText;
          safeAlert('‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', res, 'success');
          fetchData();
        }).saveData(formData);
      }
    </script>
  </body>
</html>
